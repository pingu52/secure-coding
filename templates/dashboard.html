{% extends "base.html" %} {% block title %}대시보드{% endblock %} {% block content %}
<h2>대시보드</h2>

<!-- 관리자일 경우, 관리자 페이지 버튼 표시 -->
{% if user.is_admin %}
<p><a href="{{ url_for('admin_dashboard') }}">관리자 페이지</a></p>
{% endif %}

<h3>등록된 상품</h3>
<ul>
    {% for product in products %}
    <li>
        <a href="{{ url_for('view_product', product_id=product.id) }}">{{ product.title }}</a>
        - 가격: {{ product.price }}
    </li>
    {% endfor %}
</ul>
<p><a href="{{ url_for('new_product') }}">새 상품 등록</a></p>

<h3>기능</h3>
<ul>
    <li><a href="{{ url_for('charge') }}">금액 충전</a></li>
    <li><a href="{{ url_for('transfer') }}">송금하기</a></li>
    <!-- 검색은 GET 파라미터로 받으므로, 페이지로 링크 후 검색창 표시 or 바로 form 하나 두는 방법 -->
    <li><a href="{{ url_for('search') }}">상품 검색</a></li>
</ul>

<h3>실시간 채팅</h3>
<div id="chat">
    <ul id="messages"></ul>
    <input id="chat_input" type="text" placeholder="메시지를 입력하세요" />
    <button onclick="sendMessage()">전송</button>
</div>

<script type="text/javascript">
    var socket = io();
    socket.on('connect', function () {
        console.log('채팅 서버에 연결됨');
    });
    socket.on('message', function (data) {
        var messages = document.getElementById('messages');
        var item = document.createElement('li');
        item.textContent = data.username + ': ' + data.message;
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
    });
    function sendMessage() {
        var input = document.getElementById('chat_input');
        var message = input.value;
        if (message) {
            socket.emit('send_message', { username: '{{ user.username }}', message: message });
            input.value = '';
        }
    }
</script>
{% endblock %}
